<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>All Clusters</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div id="nav-container">
    <script>
      fetch('navbar.html').then(r=>r.text()).then(html=>document.getElementById('nav-container').innerHTML=html);
    </script>
  </div>
  <script>
    fetch('navbar.html')
      .then(r=>r.text()).then(html=>document.getElementById('nav-container').innerHTML=html);
  </script>

  <div class="container my-4">
    <h2>Handwriting Clusters</h2>
    <div id="clusters" class="row gy-4"></div>
  </div>
  <script>
    // redirect to login if no token
    if (!localStorage.getItem('jwt')) {
      location.href = '/';
    }
    document.getElementById('logoutBtn').onclick = () => {
      localStorage.removeItem('jwt');
      location.href = '/';
    };
  </script>
  <script>
    async function loadClusters() {
      const token = localStorage.getItem('jwt');
      const resp = await fetch('/clusters', {
        headers:{ Authorization: `Bearer ${token}` }
      });
      const list = await resp.json();
      const container = document.getElementById('clusters');
      if (!list.length) {
        container.innerHTML = '<p>No clusters yet. Run clustering first.</p>';
        return;
      }
      // For each cluster, fetch one sample BetRecordId
      // NOTE: your /clusters only returns { id, clusterLabel, createdAt }.
      // To get a sample slip, you might want to extend that endpoint to include BetRecordId.
      // For now, assume the "id" field is the BetRecordId:
      for (const c of list) {
        const card = document.createElement('div');
        card.className = 'col-md-4';
        card.innerHTML = `
          <div class="card">
            <img src="/bets/${c.id}/slip" class="card-img-top" alt="Sample Slip">
            <div class="card-body">
              <h5 class="card-title">${c.clusterLabel}</h5>
              <p class="card-text"><small class="text-muted">Created ${new Date(c.createdAt).toLocaleString()}</small></p>
            </div>
          </div>`;
        container.append(card);
      }
    }
    loadClusters();
  </script>
</body>
</html>
